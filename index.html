<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <title>Rune</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
  <!-- <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script> -->
  <script type="text/javascript" src="L.TileLayer.Zoomify.js"></script>


  <script>
  $( initmap );

  var map;

  function initmap() {
    map = L.map('map', {
      minZoom: 1,
      maxZoom: 7,
      center: [0, 0],
      zoom: 1,
      crs: L.CRS.Simple
    });
     var w = 30000, //orginal: 3300
         h = 21212, // orginal: 2450
         url = 'kort/kort18/';
     // calculate the edges of the image, in coordinate space
     var offest = 5000;
     var southWest = map.unproject([(-1*offest), (h+offest)], map.getMaxZoom());
     var northEast = map.unproject([(w+offest), (-1*offest)], map.getMaxZoom());
     var bounds = new L.LatLngBounds(southWest, northEast);

    L.tileLayer.zoomify(url, {
        width: w,
        height: h,
        tolerance: 1,
    }).addTo(map);

    map.setMaxBounds(bounds);


     map.on('click', function(e) {
       var lng = e.latlng.lng;
       var lat = e.latlng.lat;

       // 40 meter = 173,9 - 176,6 = 2,7 -- 10m = 0,675
       var OneMeter = 0.0675

       var x = lng / OneMeter;
       var y = (lat / OneMeter) * -1;

       console("lng:"+ lng + " : " + Math.round(x) + " : square nr:"+ Math.floor( x/10 ) + "<br /> lat:"+ lat + " : " + Math.round(y) + " : square nr:"+ Math.floor( y/10 ) );


     });

     function console(str){
       $("#console").html(str);
     }
  }


  </script>
  <style >
  html,body{
    padding: 0;
    margin: 0;
  }
    #map {
      width: 100vw;
      height: 90vh;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    #console{
      padding: 10px;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    text-align: center;
    }
  </style>
</head>

<bod>
  <h4>RUNE TRIES LEAFLET</h4>
<div id="map"></div>
<div id="console"></div>

</body>
</html>
